# Base the image on Ubuntu 20.04 
FROM ubuntu:22.04 

# Image metadata
LABEL maintainer="alejandro@dpella.io"
LABEL version="0.2"
LABEL description="GHC for development"

# Set the timezone so apt-get doesn't ask for it later
ENV TZ=Europe/Stockholm
ENV WORKINGDIR=/root
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# Copy the entrypoint script and make it the container's entrypoint
COPY ./otherfiles/entrypoint.sh /bin/entrypoint

##
# Auxiliaries files for configuration of utilities  
##

# Copy activation lines for powerfile 
COPY ./otherfiles/powerline ${WORKINGDIR}

# Two lines  
COPY ./otherfiles/default.twolines.json ${WORKINGDIR}

# FZF 
COPY ./otherfiles/fzf ${WORKINGDIR}

# Install base system utilities and dependencies
RUN apt-get update \ 
    && \
    apt-get install -y --no-install-recommends \
         software-properties-common \ 
         sudo \ 
         ssh  \
         git  \
         wget \ 
         curl \ 
         make \ 
         lzma \ 
         libnuma-dev \
         zlib1g-dev \
	 libgmp-dev \
	 libgmp10 \
         liblzma-dev \ 
	 gcc \
	 autoconf \
	 automake \
	 gpg \
         dirmngr \
	 build-essential \
       	 lsb-release \
         gnupg2  

RUN apt-get install -y powerline \ 
    && \  
    apt-get install -y less \
    && \ 
    apt-get install -y vim \ 
    && \
    mkdir ~/.ssh \ 
    && \
    touch ~/.ssh/known_hosts \
    && \ 
    ssh-keyscan github.com >> ~/.ssh/known_hosts \ 
    && \ 
    chmod +x /bin/entrypoint
##
# Utilities
## 

# Trash can 
RUN apt-get install -y trash-cli 
 
# TL;DR
RUN apt-get install --yes tldr

# Fuzzy find filer
RUN apt-get install --yes fzf
RUN git clone --depth 1 https://github.com/junegunn/fzf.git ${WORKINGDIR}/.fzf
RUN cat ${WORKINGDIR}/fzf >> ${WORKINGDIR}/.bashrc && rm ${WORKINGDIR}/fzf 

# Batcat (improved cat)
RUN apt-get install --yes bat

# Weather in ASCII :)
RUN echo -e "\n weather() { curl wttr.in/$@; }" >> ${WORKINGDIR}/.bashrc

# Activate powerline 
RUN cat ${WORKINGDIR}/powerline >> ${WORKINGDIR}/.bashrc && rm ${WORKINGDIR}/powerline 

# Activate two lines powerline 
RUN mv ${WORKINGDIR}/default.twolines.json /usr/share/powerline/config_files/themes/shell
RUN sed -i 's/default_leftonly/default.twolines/g' /usr/share/powerline/config_files/config.json

# Move to the root folder
WORKDIR ${WORKINGDIR}

ENTRYPOINT [ "/bin/entrypoint" ]
