# Base the image on Ubuntu 20.04 
FROM ubuntu:20.04 

# Image metadata
LABEL maintainer="alejandro@dpella.io"
LABEL version="0.1"
LABEL description="GHC for development"

# Set the timezone so apt-get doesn't ask for it later
ENV TZ=Europe/Stockholm
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

ENV PATH="/opt/ghc/bin:${PATH}"

# BASHRC for environment variables for GHC and Powerline
COPY ./otherfiles/.bashrc /root/.bashrc

# Copy the entrypoint script and make it the container's entrypoint
COPY ./otherfiles/entrypoint.sh /bin/entrypoint

# Install base system utilities and dependencies
RUN apt-get update \ 
    && \
    apt-get install -y --no-install-recommends \
         software-properties-common \ 
         sudo \ 
         ssh  \
         git  \
         wget \ 
         curl \ 
         make \ 
         lzma \ 
         liblzma-dev \ 
         zlib1g-dev \
    && \
    add-apt-repository ppa:hvr/ghc \
    && \
    apt-get update \
    && \
    apt-get install -y cabal-install-3.4 \
    && \ 
    apt-get install -y ghc-8.6.5 \
    && \ 
    apt-get install -y ghc-9.0.1 \
    && \ 
    update-alternatives --install /usr/bin/cabal cabal /opt/cabal/bin/cabal 20 \
    && \
    update-alternatives --install /usr/bin/ghc-8.6.5 ghc /opt/ghc/bin/ghc 20 \
    && \ 
    cabal update \
    && \ 
    apt-get install -y powerline \
    && \  
    apt-get install -y less \
    && \ 
    apt-get install -y vim \ 
    && \
    mkdir ~/.ssh \ 
    && \
    touch ~/.ssh/known_hosts \
    && \ 
    ssh-keyscan github.com >> ~/.ssh/known_hosts \ 
    && \ 
    chmod +x /bin/entrypoint

RUN mkdir -p /root/.cabal 

COPY ./otherfiles/config /root/.cabal 

# Move to the root folder
WORKDIR /root

ENTRYPOINT [ "/bin/entrypoint" ]
